%head
  = wicked_pdf_stylesheet_link_tag "application"

%h3.capslock= @student.fullname
%h3= @student.student_no

-#TODO: refactor!!!
- if !@schoolyear.empty?
  - @schoolyear.each_slice(4) do |slice|
    .page
      - slice.each_slice(2).each do |pair|
        .page_col
          - pair.each do |sy|
            #quarter-stub
              %h4
                = "AY #{sy.name}"
                - unless @student.section(sy.id).nil?
                  %p.float-right
                    %span= @student.section(sy.id).name
                    = "- #{@student.section(sy.id).faculty.fullname}"
              Weighted Average:
              %b= @student.gwa_raw_schoolyear(sy)
              = "( #{@student.gwa_final_schoolyear(sy)} )"

              %table.smaller{:id => "year-#{sy.id}", :class => "zebra-striped"}
                %thead
                  %tr
                    %th Subject
                    %th Q1
                    %th Q2
                    %th Q3
                    %th Q4
                    %th Units
                    %th Average
                    %th Final
                %tbody
                  - @student.courses_year(sy.id).each do |c|
                    %tr
                      %td{:style => "text-align: left;"}= c.subject.name
                      - if !c.yearlong && c.sem == 2
                        %td -
                        %td -
                      - @student.course_grades(c.id).each do |g|
                        - if c.subject.is_pe?
                          - if pe(g.value) == 'F'
                            %td.emphasize= pe(g.value)
                          - else
                            %td= pe(g.value)
                        - elsif !g.value.nil? && g.value < 50
                          %td.emphasize= g.value
                        - else
                          %td= g.value
                      - if !c.yearlong && c.sem == 1
                        %td -
                        %td -

                      %td= c.subject.units
                      - if @student.course_has_blank(c.id)
                        %td
                        %td
                      - else
                        - ave = c.student_average(@student.id)
                        - !c.subject.is_pe? !ave.nil? && ave < 50 ? emphasize = "emphasize" : emphasize = "nope"
                        %td{:class => emphasize}= ave
                        %td
                          = @final = c.student_final(@student.id)
                          - if @final == 4.0
                            - @removal = @student.course_removed(c)
                            - if @removal.present? && @removal.pass
                              (3.0)
                            - elsif @removal.present? && !@removal.pass
                              (5.0)

